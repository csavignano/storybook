name: storybook
type: drupal11
docroot: web
php_version: "8.3"
webserver_type: nginx-fpm
xdebug_enabled: false
additional_hostnames: []
additional_fqdns: []
database:
    type: mariadb
    version: "10.11"
use_dns_when_possible: true
composer_version: "2"
web_environment: []
corepack_enable: true

# Codespaces settings
router_http_port: "8080"
router_https_port: "8443"
performance_mode: mutagen

hooks:
  post-start:
    - exec: |
        echo "ğŸ“¦ Installing Composer dependencies..."
        composer install --no-interaction --prefer-dist --optimize-autoloader
        echo "âœ… Composer install complete"
    - exec-host: |
        echo "ğŸ”„ Waiting for DDEV to be fully ready..."
        sleep 10
        echo "ğŸ“¥ Importing database..."
        if [ -f "db/site.sql.gz" ]; then
          ddev import-db --file=db/site.sql.gz
          echo "âœ… Database imported successfully"
        else
          echo "âŒ Database file not found at db/site.sql.gz"
        fi
        echo "âš™ï¸ Importing configuration..."
        ddev drush cim -y
        echo "ğŸ§¹ Clearing cache..."
        ddev drush cr
        echo "âœ… Post-start setup complete!"
    - exec: "echo 'âœ… DDEV environment is ready for development'"

  pre-stop:
    - exec-host: |
        echo "ğŸ§¹ Clearing cache before export..."
        ddev drush cr
        echo "âš™ï¸ Exporting configuration..."
        ddev drush cex -y
        echo "ğŸ’¾ Exporting database..."
        mkdir -p db
        ddev drush sql-dump --gzip --result-file=../db/site.sql
        echo "âœ… Pre-stop backup complete!"
